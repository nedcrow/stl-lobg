0923
Title Framework 만듬
Lobby로가는 서버 시스템 생성

0924
Title에서 UserID를 입력해서 서버에 들어가면 GameInstance에 아이디를 저장하는 기능추가 SaveUserID()
BattlePlayer의 crosshair HUD띄우기

컨트롤러에서 키입력을 받아 BattleCharacter에서 라인트레이스
총알이 조준한 방향으로 날아가는 기능 작성중

BulletBase라는 클래스와 블프로 Weapon폴더에 다시 만듬

0925
총알이 목표한 지점에 도달하도록 수정
하늘을 향해 발사해도 총알이 스폰되도록 수정
연사가 가능하도록 수정
총알이 플레이어나 다른 액터에 맞으면 없어지도록 수정
TakeDamage해서 죽는 애니메이션이 나오도록 연결
CurrentHP가 0이 되서 죽으면 리스폰되는 기능 추가
리스폰 기능을 게임모드로 옮기는 작업중

0926
리스폰 기능을 게임모드에서 호출하는 걸로 수정

0927
리스폰을 플레이어의 위치를 옮기는게 아닌 기존의 플레이어는 파괴하고 새 플레이어를 스폰시키는 방식으로 변경
게임모드에서 리스폰 위치를 가져오고 플레이어를 스폰 시킨 후 컨트롤러를 가져와 플레이어로 할당

해봐야 할 거 작성 : 몬스터가 죽었을 경우 경험지나 코인을 플레이어에게 전해줄 시스템 구성
임시로 박스 액터 놓고 작업할 것
리스폰 시 새로 스폰된 플레이어와 PlayerState의 동기화 작업 그전에 PlayerState에 넣을 항목 구성

임시로 미니언 액터를 만들어 미니언이 체력이 0이하가 되면 막타를 친 캐릭터가 돈과 경험치를 가져가도록 기능 추가
미니언이 준 돈과 경험치는 PlayerPS에 업데이트 되도록 BattleCharacter에 함수 추가
Bullet클래스에서 충돌한 액터가 미니언인지 플레이어 인지 검사해서 다른 데미지를 전달하도록 추가

0928
PlayerState와 UI의 동기화
리스폰 시 UI 초기화 : 체력은 꽉 차고 돈과 경험치는 그대로
경험치의 백분율 작업중

0930
데미지 테이블데이터 만들어 볼려고 했는데 잘 모르겠다.. 나중으로 미룸

1001
임시 타워를 만들고 타워가 전부 파괴되면 lobby로 넘어가는 순환 추가
타워는 게임모드에서 클래스를 받고 있어서 나중에 진짜 타워가 완성되면 게임모드의 타워 클래스로 넣어주면 된다.
경험치 UI가 경험치 수치에 맞게 게이지가 차도록 수정 이상하게 올라가던걸 수정했다.
타이틀과 로비 PC의 BeginPlay에 IsLocallyPlayerController()를 if문에 추가 에러나는 걸 방지

빨강팀 파란팀을 나누는 과정에서 GetPlayerControllerIterator()가 여러번 실행되는 문제점 발생,
원하는 결과가 나오지 않음

1002
팀나누는 과정을 로비에서 하기로 변경하고 작성했으나 아직 원하는 결과가 나오지 않는다.

1003
로비에서 접속한 플레이어를 빨강, 파랑 팀으로 나누고 UI로 표시하고 네트워크 동기화까지 함
문제는 UI네트워크 동기화 중에 다른 플레이어의 TeamColor를 바꿔버리는 문제 발생
내일 해결할 예정

1004
타이틀에서 로비로 접속하면 빨강, 파랑 팀으로 나누어지고 다른 클라이언트들도 UI 동기화된다.
게임인스턴스의 TeamColor라는 변수에 색을 넣어놔서 Battle 레벨로 넘어가도 팀이 유지된다.

1005
로비에서 정한 팀을 플레이어스테이트에 저장하고 각 플레이어에도 태그를 설정했다.
총알이 태그를 검사하고 같은 팀이라면 return해서 대미지를 가하지 않는다.
Reload애니메이션 동기화되지 않던 문제 수정
캐릭터에 총 매시를 달고 총 muzzle에서 총알이 스폰되도록 수정

1006
현재 진행된 사항
1. 타이틀에서 로그인하면 로비로 이동
2. 로비에서 팀이 나뉘지고 게임 인스턴스에 저장
3. 배틀필드로 넘어가면서 게임인스턴스에 저장된 팀에 따라 태그를 부여
4. 팀전을 펼쳐서 상대 타워, 보스를 먼저 쓰러트리면 승리
5. 타워가 전부 부숴지면 로비로 다시 이동
6. 반복

할 것
1. 상대방, 미니언, 타워, 보스의 체력이 보이게 한다
2. 에임 오프셋
3. 아이템

하던거 정리하는 시간
HPBar를 만든다.
UWidgetComponent를 받는다. HPBar로 설정한다.

체력이 변하면 HPBar를 업데이트 하도록 작성한다.
어디서? 캐릭터에서? 자신이 로컬이 아닐때만?

자기자신은 보이지 않고 상대방은 보이게 설정
어디서? 로컬컨트롤러라면 보이지 않고 아니라면 보이게 설정
게임모드에서 컨트롤러 돌면서 설정? 컨트롤러 돌면서 각자 가지고 있는 폰한테
NetMulticast로 설정?
모든 HPBar는 로컬 플레이어를 향하도록 설정
어떻게? 자신이 로컬 플레이어인지 확인 ? 잘모르겠다

1006 한것
상대 체력이 보여야하기에 HUDHPBar를 만들어서 띄우고 카메라의 회전에 맞춰서 허드도 회전하도록 했다.
IsLocallyControlled()로 로컬에서 제어한다면 HUD를 안보이게 했다.
팀에 따라 HUD의 색깔을 다르게 하고 싶었지만 아직 완성하지 못함

%%%%%%% HUD띄우는 법 %%%%%%%%%
1. 헤더에 컴포넌트로 HUDBarSceneComponent와 UWidgetComponent를 설정한다.
밑에랑 같이 쓰면 됨

UPROPERTY(BlueprintReadWrite, EditAnywhere)
class UHUDBarSceneComponent* HPBarHUD;

UPROPERTY(BlueprintReadWrite, EditAnywhere)
class UWidgetComponent* Widget;

2. cpp에 인클루드 한다
UI폴더(블루프린트 폴더 아님)의 HUDBarSceneComponent와 UHPBarWidgetBase
그리고 Components/UWidgetComponent 를 include 하고

#include "../UI/HPBarWidgetBase.h"
#include "../UI/HUDBarSceneComponent.h"
#include "Components/WidgetComponent.h"
UI폴더는 알아서 잘 찾아가야한다.

컴포넌트인 HPBarHUD와 Widget을 CreateDefaultSubobject한다.
HPBarHUD는 RootCompoennt의 자식으로, Widget은 HPBarHUD의 자식으로 설정한다.
HPBarHUD의 위치를 적절히 설정하고 Widget은 SetRelativeRotation()으로 회전값을 Yaw방향으로 180을 설정한다(중요)

ex)
HPBarHUD = CreateDefaultSubobject<UHUDBarSceneComponent>(TEXT("HPBarHUD"));
HPBarHUD->SetupAttachment(RootComponent);
HPBarHUD->SetRelativeLocation(FVector(0, 0, 110));

Widget = CreateDefaultSubobject<UWidgetComponent>(TEXT("Widget"));
Widget->SetupAttachment(HPBarHUD);
Widget->SetRelativeRotation(FRotator(0, 180.f, 0));

3. UpdateHPBar라는 함수를 만든다.
UHPBarWidgetBase* HPWidget = Cast<UHPBarWidgetBase>(Widget->GetUserWidgetObject());
	if (HPWidget)
	{
		HPWidget->SetHPBar(CurrentHP / MaxHP);
	}
를 복사 붙여넣기하고 BeginPlay()와 CurrentHP가 변할 때 호출해준다.

4. 블루프린트에디터에서 Widget 컴포넌트를 클릭하고 디테일에 UserInterface에 Widget Class를 
원하는 위젯블루프린트로 설정한다. 이미 HPBarUI라는 위젯 블루프린트가 있으니 그거로 설정해도 된다.
사이즈를 200, 30정도로 설정하면 된다.

5. 원하는 결과가 나오지 않을 때는 CurrentHP와 MaxHP가 있는지 확인해보고 CurrentHP가 MaxHP로 초기화되어있는지,
BeginPlay에서 UpdateHPBar()를 호출하고 있는지 확인한다.

1007
팀에 따라서 HPHUD의 색이 변하는 네트워크 동기화 동작